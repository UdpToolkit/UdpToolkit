  image: mcr.microsoft.com/dotnet/core/sdk:3.1
  pipelines:
    branches:
      master:
        - step:
            caches:
              - dotnetcore
            script:
              - export SOLUTION_NAME=UdpToolkit
              - export CONFIGURATION=Release
              - dotnet restore ${SOLUTION_NAME}.sln --no-cache
              - dotnet build --no-restore ${SOLUTION_NAME}.sln --configuration ${CONFIGURATION}
              - dotnet pack ./src/shared/UdpToolkit/UdpToolkit.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet pack ./src/shared/UdpToolkit.Core/UdpToolkit.Core.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet pack ./src/shared/UdpToolkit.Network/UdpToolkit.Network.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet pack ./src/shared/UdpToolkit.Serialization/UdpToolkit.Serialization.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet pack ./src/shared/UdpToolkit.Serialization.MsgPack/UdpToolkit.Serialization.MsgPack.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet pack ./src/shared/UdpToolkit.Logging/UdpToolkit.Logging.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet pack ./src/shared/UdpToolkit.Logging.Serilog/UdpToolkit.Logging.Serilog.csproj -p:PackageVersion=1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER} --configuration Release
              - dotnet nuget push ./src/shared/UdpToolkit/bin/Release/UdpToolkit.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json
              - dotnet nuget push ./src/shared/UdpToolkit.Core/bin/Release/UdpToolkit.Core.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json
              - dotnet nuget push ./src/shared/UdpToolkit.Network/bin/Release/UdpToolkit.Network.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json
              - dotnet nuget push ./src/shared/UdpToolkit.Serialization/bin/Release/UdpToolkit.Serialization.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json
              - dotnet nuget push ./src/shared/UdpToolkit.Serialization.MsgPack/bin/Release/UdpToolkit.Serialization.MsgPack.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json
              - dotnet nuget push ./src/shared/UdpToolkit.Logging/bin/Release/UdpToolkit.Logging.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json
              - dotnet nuget push ./src/shared/UdpToolkit.Logging.Serilog/bin/Release/UdpToolkit.Logging.Serilog.1.0.0-preview.0.${BITBUCKET_BUILD_NUMBER}.nupkg --api-key ${NUGET_KEY} --source https://api.nuget.org/v3/index.json